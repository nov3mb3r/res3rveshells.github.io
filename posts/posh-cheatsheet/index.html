<!doctype html><html lang=en-us><head><title>PoSh Cheatsheet // res3rveShells</title><meta charset=utf-8><meta name=generator content="Hugo 0.58.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=res3rveShells><meta name=description content><link rel=stylesheet href=https://res3rveshells.github.io/css/main.min.8089294ef01297feed30286d02f1652e2e67c7006242b21b0401a0cdf7c756be.css><meta name=twitter:card content=summary><meta name=twitter:title content="PoSh Cheatsheet"><meta name=twitter:description content="PowerShell Cheatsheet for Incident Response During September we competed in PoSh-Hunter, a jeopardy style CTF to test our PowerShell skills in triage (and host enumeration). The flags were mostly the output of a command relating to one of the following 8 challenges:
 Encryption\Cipher Filesystem Registry Logs\ Tasks Enterprise Services DNS Data Manipulation Q\A  Rules of engagement  Download the PoSh Hunter VM and log in using the credentials provided Use the PoSh Hunter VM to answer the challenges (minus the Q/A general PowerShell knowledge questions) The point value for questions varies based on difficulty  Disclaimer We don&rsquo;t want to spoil the CTF since it is still active, so we decided to make a (non-exhaustive) list of commands that were used during the game, and will definitely be useful in your infosec career."><meta property=og:title content="PoSh Cheatsheet"><meta property=og:description content="PowerShell Cheatsheet for Incident Response During September we competed in PoSh-Hunter, a jeopardy style CTF to test our PowerShell skills in triage (and host enumeration). The flags were mostly the output of a command relating to one of the following 8 challenges:
 Encryption\Cipher Filesystem Registry Logs\ Tasks Enterprise Services DNS Data Manipulation Q\A  Rules of engagement  Download the PoSh Hunter VM and log in using the credentials provided Use the PoSh Hunter VM to answer the challenges (minus the Q/A general PowerShell knowledge questions) The point value for questions varies based on difficulty  Disclaimer We don&rsquo;t want to spoil the CTF since it is still active, so we decided to make a (non-exhaustive) list of commands that were used during the game, and will definitely be useful in your infosec career."><meta property=og:type content=article><meta property=og:url content=https://res3rveshells.github.io/posts/posh-cheatsheet/><meta property=article:published_time content=2019-10-19T00:00:00+00:00><meta property=article:modified_time content=2019-10-19T00:00:00+00:00><link href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap" rel=stylesheet></head><body><header class=app-header><div><a class=app-header-logo-container href=https://res3rveshells.github.io/><pre class="app-header-logo-text unselectable">
                        ________                        
_______   ____    ______\_____  \_______ ___  __  ____  
\_  __ \_/ __ \  /  ___/  _(__  &lt;\_  __ \\  \/ /_/ __ \ 
 |  | \/\  ___/  \___ \  /       \|  | \/ \   / \  ___/ 
 |__|    \___  >/____  >/______  /|__|     \_/   \___  >
             \/      \/        \/                    \/ 
             .__             .__   .__                  
       ______|  |__    ____  |  |  |  |    ______       
      /  ___/|  |  \ _/ __ \ |  |  |  |   /  ___/       
      \___ \ |   Y  \\  ___/ |  |__|  |__ \___ \        
     /____  >|___|  / \___  >|____/|____//____  >       
          \/      \/      \/                  \/        
      </pre></a><p class=app-header-item>Cyber Security Researchers, CTF Team</p><div class=app-header-item><a class=menu-tag href=https://res3rveshells.github.io/>main</a>
<a class=menu-tag href=/tags/write-ups>write-ups</a>
<a class=menu-tag href=/posts/content>content</a>
<a class=menu-tag href=/posts/about>about</a></div><div class=divider></div></div><div class=app-header-social><a target=_blank href=https://github.com/res3rveshells><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0 0 20 4.77 5.07 5.07.0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38.0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 0 0 5 4.77a5.44 5.44.0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 0 0 9 18.13V22"/></svg></a><a target=_blank href=https://www.hackthebox.eu/home/teams/profile/1723><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>PoSh Cheatsheet</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><path d="M16 2V6z"/><path d="M8 2V6z"/><path d="M3 10H21z"/></svg>&nbsp;
Oct 19, 2019</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>&nbsp;
4 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83.0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><path d="M7 7V7z"/></svg>&nbsp;
<a class=tag href=https://res3rveshells.github.io/tags/posh-hunter/>PoSh-Hunter</a><a class=tag href=https://res3rveshells.github.io/tags/write-ups/>write-ups</a><a class=tag href=https://res3rveshells.github.io/tags/powershell/>powershell</a><a class=tag href=https://res3rveshells.github.io/tags/ps/>ps</a><a class=tag href=https://res3rveshells.github.io/tags/ctf/>ctf</a><a class=tag href=https://res3rveshells.github.io/tags/jeopardy/>jeopardy</a></div></div></header><div class=post-content><h1 id=powershell-cheatsheet-for-incident-response>PowerShell Cheatsheet for Incident Response</h1><p>During September we competed in <a href=https://posh-hunter.com>PoSh-Hunter</a>, a jeopardy style CTF to test our PowerShell skills in triage (and host enumeration). The flags were mostly the output of a command relating to one of the following 8 challenges:</p><ul><li>Encryption\Cipher</li><li>Filesystem</li><li>Registry</li><li>Logs\ Tasks</li><li>Enterprise Services</li><li>DNS</li><li>Data Manipulation</li><li>Q\A</li></ul><h4 id=rules-of-engagement>Rules of engagement</h4><ul><li>Download the PoSh Hunter VM and log in using the credentials provided</li><li>Use the PoSh Hunter VM to answer the challenges (minus the Q/A general PowerShell knowledge questions)</li><li>The point value for questions varies based on difficulty</li></ul><h4 id=disclaimer>Disclaimer</h4><p>We don&rsquo;t want to spoil the CTF since it is still active, so we decided to make a (non-exhaustive) list of commands that were used during the game,
and will definitely be useful in your infosec career. Blue teams take notice!</p><h5 id=enough-chit-chat-let-s-jump-straight-to-the-cheatsheet>Enough chit-chat. Let&rsquo;s jump straight to the cheatsheet!</h5><h2 id=powershell-commands-cheetsheet>PowerShell commands cheetsheet</h2><p>One cool feature of PowerShell is that its commands are case insensitive. It doesn&rsquo;t matter if you type <code>Get-ChildItem</code> or <code>get-childitem</code> or even <code>get-childiTem</code></p><p>Be sure to swap out any <code>user_input_name</code> with your actual input.</p><table><thead><tr><th>Action</th><th align=left>PowerShell</th></tr></thead><tbody><tr><td>Find PowerShell version</td><td align=left>$psversiontable</td></tr><tr><td>Get ps profile list</td><td align=left>$PROFILE</td></tr><tr><td>Get hostname</td><td align=left>$env:computername</td></tr><tr><td>Find Bios info</td><td align=left>Get-WmiObject -Class Win32_BIOS</td></tr><tr><td>Check if a file exists</td><td align=left>Test-Path <code>file1</code></td></tr><tr><td>Print the first column of a file</td><td align=left>Get-Content <code>file</code> | %{ $_.Split(&lsquo;,&rsquo;)[<code>1</code>]; }</td></tr><tr><td>Find 3356th and 6002nd word of a file</td><td align=left>(Get-Content <code>file</code>).split()[3356,6002]</td></tr><tr><td>Display hidden files inside a directory</td><td align=left>Get-ChildItem -force</td></tr><tr><td>List files with Alternate Data Streams on C:\ drive. [only for NTFS partitions]</td><td align=left>Get-Item -path <code>C:\</code> -Stream *</td></tr><tr><td>Check the contents of ADS</td><td align=left>Get-Content -path <code>path/file_name</code> -Stream <code>stream_name</code></td></tr><tr><td>Search files based on their MD5 hash</td><td align=left>Get-ChildItem | Get-FileHash -a md5 | Where-Object hash -eq <code>MD5_hash_value</code></td></tr><tr><td>List running services</td><td align=left>Get-Service | Where-Object {$_.Status -eq &ldquo;Running&rdquo;}</td></tr><tr><td>List scheduled tasks</td><td align=left>Get-ScheduledTask</td></tr><tr><td>More info on specific task</td><td align=left>Get-ScheduledTaskInfo <code>task_name</code></td></tr><tr><td>List mounted drives</td><td align=left>Get-PSDrive</td></tr><tr><td>List connections along with their PID, and ports</td><td align=left>netstat -nabo</td></tr><tr><td>Find file path of a process</td><td align=left>Get-Process <code>proccess_name</code> -FileVersionInfo</td></tr><tr><td>Find total Active Directory users</td><td align=left>Get-ADUser -filter * | MeasureObject</td></tr><tr><td>Find disabled Active Directory accounts</td><td align=left>dsquery user -disabled</td></tr><tr><td>Find number of GPOs</td><td align=left>(Get-GPO -All).count</td></tr><tr><td>Find certificate issuer</td><td align=left>Get-ChildItem -path cert: -Recurse | Select-String &ldquo;issuer_name&rdquo; | Select-String &ldquo;Issuer&rdquo;</td></tr><tr><td>Find anything that starts with &lsquo;reserve&rsquo;</td><td align=left>Select-String -Pattern &lsquo;^reserve&rsquo;</td></tr><tr><td>Find the total number of expired certs</td><td align=left>Get-ChildItem cert:\ -Recurse | Where-Object {$_ -is [System.Security.Cryptography.X509Certificates.X509Certificate2] -and $_.NotAfter -lt (Get-Date)} | Measure-Object</td></tr><tr><td>Find DNS sinkhole</td><td align=left>Get-DnsServerZone | Where-Object { $_.IsReverseLookupZone -eq $false }).ZoneName</td></tr><tr><td>Count SAM account names that end with s</td><td align=left>Get-ADUSer -Filter &lsquo;SamAccountName -like &ldquo;*s&rdquo;&rsquo;</td></tr><tr><td>Find registered (user) info</td><td align=left>Get-ItemProperty Registry::HKEY_LOCAL_MACHINE</td></tr><tr><td>Find startup execution from shell</td><td align=left>Get-ItemProperty Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall</td></tr><tr><td>Find installed programs</td><td align=left>Get-ItemProperty Registry::HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall</td></tr><tr><td>Compare the content of 2 files</td><td align=left>Compare-Object -ReferenceObject (Get-Content <code>file1</code>) -DifferenceObject(Get-Content <code>file2</code>)</td></tr></tbody></table><p>For the sake of completeness, here is a small list of the most common bash commands with their PowerShell equivalents.</p><table><thead><tr><th>Bash</th><th align=left>PowerShell</th></tr></thead><tbody><tr><td><code>cd</code></td><td align=left><code>cd</code> or <code>Set-Location</code></td></tr><tr><td><code>ls</code></td><td align=left><code>ls</code> or <code>Get-ChildItem</code></td></tr><tr><td><code>pwd</code></td><td align=left><code>pwd</code> or <code>Get-Location</code></td></tr><tr><td><code>cat</code></td><td align=left><code>cat</code> or <code>Get-Content</code></td></tr><tr><td><code>man</code></td><td align=left><code>man</code> or <code>Get-Help</code></td></tr><tr><td><code>grep</code></td><td align=left><code>Select-String</code></td></tr><tr><td><code>cp</code></td><td align=left><code>cp</code></td></tr><tr><td><code>rm</code></td><td align=left><code>Remove-Item</code></td></tr><tr><td><code>wget</code></td><td align=left><code>Invoke-WebRequest</code></td></tr><tr><td><code>ping</code></td><td align=left><code>Test-Connection</code></td></tr><tr><td><code>wc</code></td><td align=left><code>Measure-Object</code></td></tr></tbody></table><h1 id=verdict>Verdict:</h1><p><img src=https://img.shields.io/badge/Challenges-Passed-green alt> <img src=https://img.shields.io/badge/Difficulty-Medium-orange alt></p><h3 id=emerging-victors>Emerging victors</h3><p>When first visiting the <a href=https://posh-hunter.com>PoSh-Hunter</a> site you are greeted by the following message:<br><code>Are Your PowerShell Skills Strong Enough to Survive?</code><br>Well PoSh-Hunter Team we salute you!</p><p><img src=../../static/img/posh-cheatsheet/newplot.png alt=Ranking></p><p>We completed ALL challenges and made it to the top. Although we weren&rsquo;t the first team to submit all flags (we started later that other teams)
, we ranked 6th out of 152 teams that competed. Only the first 9 teams managed to get all flags and beat the game.</p><h3 id=takeaways>Takeaways</h3><p>Overall it&rsquo;s a great CTF to hone your skills in PowerShell whether you are a seasoned Incident Responder, or just started your infosec
journey. Of course you don&rsquo;t have to be a scripting master or know all commands by heart. Most of the commands&rsquo; names are self-explanatory and human readable (but sometimes too long).<br>If you don&rsquo;t have enough experience with the command line, you might find challenging combining pipes to filter your results. Don&rsquo;t worry, Google (or DuckDuckGo if you are use a tinfoil) is your friend.<br>If you have trouble with Active Directory, you can use the built-in management tools that come with GUI. The big picture of playing such CTFs is to become better at finding evil inside a system. How you decide to use your tool arsenal, is your choice.</p><p>Remember if you can&rsquo;t find a way, make your own!</p></div><div class=post-footer></div></article></main></body></html>