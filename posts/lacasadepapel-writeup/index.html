<!doctype html><html lang=en-us><head><title>LaCasaDePapel Hack The Box Writeup // res3rveShells</title><meta charset=utf-8><meta name=generator content="Hugo 0.58.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content=res3rveShells><meta name=description content><link rel=stylesheet href=https://res3rveshells.github.io/css/main.min.62abcee8dfaad13b27064f250a39814b70049dbcd02b1e39f35d21297de924ee.css><meta name=twitter:card content=summary><meta name=twitter:title content="LaCasaDePapel Hack The Box Writeup"><meta name=twitter:description content="Machine Info LaCasaDePapel is an Easy difficulty machine in the Hack The Box platform that that tests your certificate knowledge and some basic CVE knowledge for the user part of the box. The root part of the box is easier than the user requiring basic enumeration and linux os knowledge.
Solution Enumeration Classic nmap enumeration
sudo nmap -Pn -sV -sT -T4 -oN ports.txt lacasadepapel.htb  Let&rsquo;s investigate the open ports 21,80,443:"><meta property=og:title content="LaCasaDePapel Hack The Box Writeup"><meta property=og:description content="Machine Info LaCasaDePapel is an Easy difficulty machine in the Hack The Box platform that that tests your certificate knowledge and some basic CVE knowledge for the user part of the box. The root part of the box is easier than the user requiring basic enumeration and linux os knowledge.
Solution Enumeration Classic nmap enumeration
sudo nmap -Pn -sV -sT -T4 -oN ports.txt lacasadepapel.htb  Let&rsquo;s investigate the open ports 21,80,443:"><meta property=og:type content=article><meta property=og:url content=https://res3rveshells.github.io/posts/lacasadepapel-writeup/><meta property=article:published_time content=2019-07-27T11:04:51+03:00><meta property=article:modified_time content=2019-07-27T11:04:51+03:00></head><body><header class=app-header><div><a href=https://res3rveshells.github.io/><pre class="app-header-logo-text unselectable">
                        ________                        
_______   ____    ______\_____  \_______ ___  __  ____  
\_  __ \_/ __ \  /  ___/  _(__  &lt;\_  __ \\  \/ /_/ __ \ 
 |  | \/\  ___/  \___ \  /       \|  | \/ \   / \  ___/ 
 |__|    \___  >/____  >/______  /|__|     \_/   \___  >
             \/      \/        \/                    \/ 
             .__             .__   .__                  
       ______|  |__    ____  |  |  |  |    ______       
      /  ___/|  |  \ _/ __ \ |  |  |  |   /  ___/       
      \___ \ |   Y  \\  ___/ |  |__|  |__ \___ \        
     /____  >|___|  / \___  >|____/|____//____  >       
          \/      \/      \/                  \/        
      </pre></a><p class=app-header-item>CTF Team, Cyber Security Researchers</p><div class=app-header-item><a class=menu-tag href=https://res3rveshells.github.io/>main</a>
<a class=menu-tag href=/tags/write-ups>write-ups</a>
<a class=menu-tag href=/posts/content>content</a>
<a class=menu-tag href=/posts/about>about</a></div><div class=divider></div></div><div class=app-header-social><a target=_blank href=https://github.com/res3rveshells><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github"><title>github</title><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37.0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44.0 0 0 20 4.77 5.07 5.07.0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38.0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07.0 0 0 5 4.77a5.44 5.44.0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37.0 0 0 9 18.13V22"/></svg></a><a target=_blank href=https://www.hackthebox.eu/home/teams/profile/1723><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg></a></div></header><main class=app-container><article class=post><header class=post-header><h1 class=post-title>LaCasaDePapel Hack The Box Writeup</h1><div class=post-meta><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar"><title>calendar</title><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><path d="M16 2V6z"/><path d="M8 2V6z"/><path d="M3 10H21z"/></svg>Jul 27, 2019</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock"><title>clock</title><circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/></svg>3 min read</div><div><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag"><title>tag</title><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83.0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><path d="M7 7V7z"/></svg><a class=tag href=https://res3rveshells.github.io/tags/lacasadepapel/>lacasadepapel</a><a class=tag href=https://res3rveshells.github.io/tags/write-ups/>write-ups</a><a class=tag href=https://res3rveshells.github.io/tags/hackthebox/>hackthebox</a></div></div></header><div class=post-content><h2 id=machine-info>Machine Info</h2><p>LaCasaDePapel is an Easy difficulty machine in the Hack The Box platform that
that tests your certificate knowledge and some basic CVE knowledge for the <strong>user</strong>
part of the box. The <strong>root</strong> part of the box is easier than the user requiring basic
enumeration and linux os knowledge.</p><h2 id=solution>Solution</h2><h3 id=enumeration>Enumeration</h3><p>Classic nmap enumeration</p><pre><code class=language-bash>sudo nmap -Pn -sV -sT -T4 -oN ports.txt lacasadepapel.htb
</code></pre><p><img src=../../static/img/lacasadepapel/lacasadepapel_1.png alt=NmapScan></p><p><strong>Let&rsquo;s investigate the open ports 21,80,443:</strong></p><h4 id=port-21>Port 21</h4><p>Runs vsftpd 2.3.4 an ftp vulnerable service.Although this vulnerability exists as a metasploit module
it won&rsquo;t work by default so it&rsquo;s better to investigate the vulnerability and exploit it manually.<br>We can trigger the vulnerability by adding a smiley face at the end of username it will open port 6200</p><p><strong>Exploit Trigger</strong><br><img src=../../static/img/lacasadepapel/lacasadepapel_2.png alt=Vsftpd></p><p><strong>Telnet 6200 port</strong><br><img src=../../static/img/lacasadepapel/lacasadepapel_3.png alt=6200></p><p>We telnet into a Psy Shell a shell variant written in php we can see the commands available to us with <code>help</code>
The <code>ls</code> and <code>show</code> commands are interesting let&rsquo;s see what we can find out.</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_4.png alt=PsyHelp></p><p>We see a path to a ca key maybe we can run some php functions in the shell like <code>file_get_contents</code></p><p><img src=../../static/img/lacasadepapel/lacasadepapel_5.png alt=PsyKey></p><h4 id=port-80>Port 80</h4><p>The http port contains an html page with a QR code to some kind of OTP key let&rsquo;s analyze the QR link</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_6.png alt=QRLink></p><p>There is a secret hashed with SHA1 probably</p><h4 id=port-443>Port 443</h4><p>The https port contains another html page requring a client certificate</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_7.png alt=HTTPSLink></p><h3 id=exploit>Exploit</h3><h4 id=pwn-user>Pwn User</h4><p>Using the ca.key we retrieved from the Psy Shell access to create a certificate seems the most promising path
We will use <code>openssl</code> to create</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_8.png alt=PemKey></p><p>Then we will combine those two keys to create a client certificate with pkcs12</p><pre><code class=language-bash># Leave password prompt blank
openssl pkcs12 -export -out certificate -in ca.pem -inkey ca.key
</code></pre><p>Import the client certificate to firefox and access <a href=https://10.10.10.131>https://10.10.10.131</a>
A simple web page with 2 links for <strong>Season1</strong> and <strong>Season2</strong> but notice the url a <code>path</code> variable that <strong>suggests path traversal</strong></p><p><img src=../../static/img/lacasadepapel/lacasadepapel_10.png alt=PathTraversal></p><p><img src=../../static/img/lacasadepapel/lacasadepapel_11.png alt=PathResult></p><p>So let&rsquo;s enumerate the system a bit check for users in <code>passwd</code> and directories in the <code>home</code> directory.
We can see the files but we can&rsquo;t download them or open them somehow.Or can we?<br>The two season folders contain links to the episodes and by investigating that url</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_12.png alt=EpisodeUrl></p><p>It probably references the episode path so it&rsquo;s some kind of encoding <strong>base64</strong> probably so let&rsquo;s decode it</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_13.png alt=Decode></p><p>That means we have to do the opposite and exploit the endpoint.Encode the paths for the <code>user.txt</code> and the <code>id_rsa</code> file inside the <code>.ssh</code> directory and don&rsquo;t forget to use the <code>-n</code> identifier to delete training <code>'/n'</code> or it will break the web app.</p><pre><code class=language-bash>echo -n &quot;../.ssh/id_rsa&quot;|base64
</code></pre><h4 id=pwn-root>Pwn Root</h4><p>We retrieved the rsa key from <code>berlin</code> user directory but we cant ssh in berlin user.From the <code>passwd</code> we know the other users inside the machine let&rsquo;s try <code>professor</code> he is berlin&rsquo;s brother after all (I just brute force tried every user).<br>And we are in!
Professor&rsquo;s home directory has some interesting files</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_15.png alt=Professor></p><p>We can&rsquo;t modify any of the memcached files but the <code>memcached.ini</code> which we can read seems to contain a command the <code>.js</code> file executes and as root which is very convenient!</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_14.png alt=MemcachedGood></p><p>Luckily we are the owners of the folder so let&rsquo;s remove the <code>memcached.ini</code> with our own one</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_17.png alt=MemcachedEvil></p><p>Catch your shell and print your money!</p><p><img src=../../static/img/lacasadepapel/lacasadepapel_16.png alt=Pwned></p><h2 id=conclusion>Conclusion</h2><p>A very nice machine especially the user part will make you search for things like certificate authorities for TLS encyprtion and how the internals work. Also the Psy Shell part was something new for me.<br>The root part was kinda quick and easy especially if you know linux file permission&rsquo;s and have read about memcached before.</p><p>Bella Ciao!</p></div><div class=post-footer></div></article></main></body></html>